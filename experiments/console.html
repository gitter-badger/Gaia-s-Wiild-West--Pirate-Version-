<html>
	<head>
		<meta charset="UTF-8">
		<title>Console</title>
		<style>
			body {
				margin:0;
				padding:0;
				background: #ccc;
			}
			#viewport {
				width: 100%;
				height: 100%;
				cursor: url('assets/UI/cursorActive.cur'), url('assets/UI/cursorActive.png'), auto ;
			}

		</style>
		<link rel="stylesheet" href="console.css">
	</head>
	<body>
		<div class='select'>
			<div class='select-header'>
				<span data-value='0' class='selected-item'>Selecione</span>
			</div>
			<div class='select-options'>
				<ul class='select-items' >
					<li data-value='1'>Item 1</li>
					<li data-value='2'>Item 2</li>
					<li data-value='3'>Item 3</li>
					<li data-value='4'>Item 4</li>
				</ul>	
			</div>
		</div>
		
		<div id='viewport'>
			<div id="console">
				<div id="consoleRightMenu">
					<li data-module="" class='active'></li>
					<li data-module=""></li>
					<li data-module=""></li>
					<li data-module=""></li>
				</div>

				<div id="consoleLeftMenu" class=''>
					<div class="console-panel">
						<div>
							<span class='object-name'>Assets</span>
						</div>
						<div class="console-container">
							<div class="console-tabs">
								<div class="console-tabs-header">
									<li data-href='tab-1'>Nature</li>
									<li class='active' >Building</li>
									<li>Animals</li>
								</div>
								<div class='console-tabs-content'>
									<div class='tab-1'>
										<li>
											<img src="../assets/nature/savanna/tree.png" height='80px' alt="">
										</li>
										<li class="active">
											<img src="../assets/nature/savanna/tree1.png" height='80px' alt="">
										</li>	
									</div>	
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	
	<script>
		window.gww = {};

		window.gww.size = 10413;
		window.gww.width = 12;
		window.gww.height = 14;

		window.gww.biome = "savanna";
		window.gww.amount = 20;

		window.gww.show = function () {
			console.log('show');
		}


		// window.gww.number = 12;
		// window.gww.watch("number", changeHandler);

		// function changeHandler () {
		// 	console.log('o valor mudou');
		// }
	</script>

	<script>

		
		window.onload = initConsole;

		function initConsole() {

			var Structure = {
				Battlefield: {
					width : {
						controller: "input",
						type: "integer",
						watch: gww.width
					},
					height : {
						controller: "input",
						type: "integer",
						watch: gww.height
					},
					size : {
						controller: "input-disabled",
						type: "integer",
						watch: gww.size,
					},
					generate_arena : {
						controller: "button",
						func: gww.show
					}
				},

				Environment: {
					biome: {
						controller: "input",
						type: "string",
						watch: gww.biome
					},
					population: {
						controller: "input",
						type: "integer",
						watch: gww.amount
					}
				}
			};

			createStructure(Structure);
			addEvents();
			
			initSelect();
		}

		function createStructure(structure) {
			var body = document.getElementsByTagName('body')[0],
				// consoleDiv = document.createElement('div');
				// consoleDiv.id = "console";

				// body.appendChild(consoleDiv);
				consoleDiv = document.getElementById('consoleLeftMenu');

			for (i in structure) {
				if (structure.hasOwnProperty(i)) {
					consoleDiv.appendChild(_createPanelTitle(i, structure[i]));
				}
			}
		}

		function _createPanelTitle(title, configs) {
			var consolePanel = E('div', {class: "console-panel"}),
				consoleControllers = E('div', {class: "console-container"}),

				objectNameWrapper = E('div'),
				objectName = E('span', {class: 'object-name', text: title});


			objectNameWrapper.appendChild(objectName);
			consolePanel.appendChild(objectNameWrapper);


			for (o in configs) {
				if (configs.hasOwnProperty(o)) {
					consoleControllers.appendChild(_createTweakerController(o, configs[o]));
				}
			}

			consolePanel.appendChild(consoleControllers);
			return consolePanel;
		}

		function _createTweakerController(title, configs) {
			var li = E('li'),
				controllerType = "";

			title = title.replace('_', ' ');

			controllerType = li.className = configs.hasOwnProperty("controller") ? configs.controller : "";

			switch(controllerType) {

			case "input":
			case "input-disabled":
				var propertyName = E('span', {class: "property-name", text: title}),
					inputWrapper = E('div', {class: "property-value"});
					input = E('input', {type: 'input', value: configs.watch}, inputWrapper);

				if (controllerType.indexOf("disabled") > -1) {
					input.setAttribute("disabled", "disabled");
				}

				if (controllerType.indexOf("disabled") > -1) {
					input.setAttribute("disabled", "disabled");
				}

				li.appendChild(propertyName);
				li.appendChild(inputWrapper);

				break;

			case "button":
				var buttonWrapper = E('div', {class: 'button'}),
					button = E('span', {class:'button', href: 'javascript:void(0);', text: title}, buttonWrapper);

				li.appendChild(buttonWrapper);
				button.addEventListener('click', configs.func, false);
				break;
			}

			return li;
		}

		function E(name, configs, parent) {
			
			var element = document.createElement(name),
				attributes = ['id', 'class', 'title', 'type', 'name', 'value', 'href', 'disabled'];
			
			if (Object.prototype.toString.call(configs) === "[object Object]") {

				for (i in attributes) {

					attr = attributes[i];

					if (configs.hasOwnProperty(attr)) {
						element.setAttribute(attr, configs[attr]);
					}					
				}

				if (configs.hasOwnProperty("text")) {
					element.appendChild(document.createTextNode(configs.text));
				}	
			}

			if (typeof(parent) !== "undefined") {
				parent.appendChild(element);
			}

			return element;
		}

		function addEvents() {
			var spans = document.getElementsByTagName('span');
			for (i = 0; i < spans.length; i++) {
				if (spans[i].getAttribute('class') === 'object-name') {
					// adding listener
					spans[i].addEventListener('click', togglePanel, false);
				}
			}
		}

		function togglePanel (e) {
			var elem = e.target, // verificar browser compatibility
				parent = elem.parentNode,
				sibling = parent.nextSibling;
				className = "";

			while(sibling && sibling.nodeType != 1) {
				sibling = sibling.nextSibling;
			}

			className = sibling.getAttribute('class');

			if (className.indexOf('console-container') > -1) {
				if (className.indexOf('close') > -1) {
					className = className.replace('close', '');
				} else {
					className += " close";
				}
			}
			sibling.className = className;
		}
	</script>

	<script>
		if (!Object.keys) {
			Object.keys = (function () {
				var hasOwnProperty = Object.prototype.hasOwnProperty,
					hasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),
					dontEnums = ['toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor' ],
					dontEnumsLength = dontEnums.length;

				return function (obj) {
					var result = [],
						prop,
						i;

					if ((typeof obj !== 'object' && typeof obj !== 'function') || obj === null) {
						throw new TypeError("Object.keys called on non-object");
					}

					for (prop in obj) {
						if (obj.hasOwnProperty(prop)) {
							result.push(prop);
						}
					}

					if (hasDontEnumBug) {
						for (i = 0; i < dontEnumsLength; i++) {
							if (hasOwnProperty.call(obj, dontEnums[i])) {
								result.push(dontEnums[i]);
							}
						}
					}
					return result;
				};
			}());
		}

		/*
		* object.watch polyfill
		*
		* 2012-04-03
		*
		* By Eli Grey, http://eligrey.com
		* Public Domain.
		* NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
		*/
		 
		// object.watch
		if (!Object.prototype.watch) {
		Object.defineProperty(Object.prototype, "watch", {
		enumerable: false
		, configurable: true
		, writable: false
		, value: function (prop, handler) {
		var
		oldval = this[prop]
		, newval = oldval
		, getter = function () {
		return newval;
		}
		, setter = function (val) {
		oldval = newval;
		return newval = handler.call(this, prop, oldval, val);
		}
		;
		if (delete this[prop]) { // can't watch constants
		Object.defineProperty(this, prop, {
		get: getter
		, set: setter
		, enumerable: true
		, configurable: true
		});
		}
		}
		});
		}
		 
		// object.unwatch
		if (!Object.prototype.unwatch) {
		Object.defineProperty(Object.prototype, "unwatch", {
		enumerable: false
		, configurable: true
		, writable: false
		, value: function (prop) {
		var val = this[prop];
		delete this[prop]; // remove accessors
		this[prop] = val;
		}
		});
		}
	</script>
	
	<script>
		
		function initSelect() {
			var selects = document.getElementsByTagName('ul');
			var options = [];
			
			for (i=0; i < selects.length; i++) {
				if (selects[i].className === "select-items") {
					options = selects[i].children;
					
					for (j=0; j < options.length; j++) {
						options[j].addEventListener('click', updateSelectedItem, false);
					}
				}
			}	
		}
		
		function updateSelectedItem (e) {
			element = e.target;
			console.log("text: " + element.innerHTML);
			console.log("value: "+ element.getAttribute("data-value"));
		}
	</script>
</html>
